# Платформа обработки и прогнозирования чеков (LukRecSys)

Автор проекта: @ten101111

Проект объединяет инструменты для:
- обработки сырых чеков по АЗС,
- построения прогноза чеков (МЛ/веса/текущая логика),
- формирования файлов рассылок и аналитики по результатам.

Основной способ работы — через GUI, но все ключевые скрипты можно запускать отдельно.

---

## Состав проекта

Основные каталоги:
- `Обработка чеков/` — сбор и подготовка чеков, объединение, агрегирование.
- `ИИ прогнозирование Чеков/` — прогнозирование, экспорт результатов, формат рассылок.
- `Проверка чеков/` — проверка/анализ рассылок, расчеты часов и вспомогательные отчеты.
- `Сравнение моделей/` — метрики и сравнение моделей.

Точки входа:
- `platform_gui.py` — главный GUI с вкладками «Обработка чеков» и «Прогнозирование».
- `Обработка чеков/platform_gui.py` — GUI для обработки чеков.
- `ИИ прогнозирование Чеков/platform_gui.py` — GUI для прогнозирования.
- `ИИ прогнозирование Чеков/Прогнозирование на основе МЛ и ВЕСА.py` — основной скрипт прогноза.

---

## Быстрый старт (GUI)

1) Подготовьте исходные данные по чекам (CSV).
2) Запустите главный интерфейс:
   ```bash
   python platform_gui.py
   ```
3) Вкладка «Обработка чеков» — обновите/соберите массив чеков.
4) Вкладка «Прогнозирование» — запустите прогнозирование и экспорт файлов.

Результаты сохраняются в папках выгрузки внутри `ИИ прогнозирование Чеков/Выгрузки`.

---

## Подготовка данных

В проекте используются следующие ключевые файлы:
- `АЗС для прогноза.xlsx` — список КССС, по которым строится прогноз.
- `cls_2025_12_AZS.xlsx` — справочник для подстановки НПО/РУ/ТМ/Менеджера/Названия АЗС.
- CSV с фактическими чеками — источник факта для прогноза.

Пути к данным по умолчанию подтягиваются из `ИИ прогнозирование Чеков/constants.py`
и обновляются автоматически (берется последняя папка/файл).

---

## Прогнозирование

Скрипт: `ИИ прогнозирование Чеков/Прогнозирование на основе МЛ и ВЕСА.py`

Что делает:
- выбирает лучший метод прогноза по MAPE;
- строит прогноз по дням;
- рассчитывает дневные/ночные часы;
- сохраняет результат в CSV;
- формирует файл рассылки рекомендаций в формате шаблона.

Выходы:
- итоговый прогноз чеков (CSV):  
  `ИИ прогнозирование Чеков/Выгрузки/Итоговые чеки/Прогноз от DD.MM.YYYY/Прогноз чеков от DD.MM.YYYY HH.MM.csv`
- файл сравнения моделей (CSV):  
  `ИИ прогнозирование Чеков/Выгрузки/Константы/Оптимальная модель/...`
- файл рассылки (XLSX) по шаблону:  
  `ИИ прогнозирование Чеков/Выгрузки/Рекомендации формат/Рекомендации <Месяц> <Год>/MM.YY <Месяц> <Год> (DD.MM.YYYY HH.MM).xlsx`

---

## Переменные окружения (опционально)

Для точечной настройки прогноза можно использовать переменные окружения:
- `CHECKS_PATH_OVERRIDE` — путь к CSV с чеками (если не брать из `constants.py`).
- `FORECAST_START`, `FORECAST_END` — вручную задать период прогноза (YYYY-MM-DD).
- `CHECKS_DELIMITER` — разделитель CSV (по умолчанию `|`).
- `AZS_LIMIT_COUNT` — ограничение количества АЗС.
- `KSSS_RANGE_START`, `KSSS_RANGE_END` — диапазон КССС.
- `KSSS_LIST` — список КССС через запятую.
- `PROGRESS_FILE`, `STOP_FILE`, `RESULT_DIR_FILE` — служебные пути для GUI.

---

## Проверка/аналитика рассылок

Каталог: `Проверка чеков/`

Используется для:
- преобразования файлов рассылок в удобные таблицы,
- расчёта часов,
- формирования сводных отчётов.

Основные скрипты:
- `Проверка чеков/Database_check_former.py`
- `Проверка чеков/Hours_check.py`
- `Проверка чеков/Check_check_functions.py`

---

## Обработка чеков

Каталог: `Обработка чеков/`

Включает:
- сбор сырых CSV по чекам,
- объединение и агрегацию,
- подготовку итогового массива.

Вспомогательная документация: `Description.txt`.

---

## Зависимости

Проект использует стандартный Python-стек анализа данных:
- `pandas`, `numpy`, `openpyxl`
- дополнительные библиотеки для ML и статистики (например, `scikit-learn`, `statsmodels`, `torch`)

Рекомендуется использовать виртуальное окружение и установить зависимости под ваш сценарий.

---

## Полезные замечания

- Все пути и “последние файлы” подтягиваются автоматически, но их можно переопределять.
- `АЗС для прогноза.xlsx` и `cls_2025_12_AZS.xlsx` должны быть актуальными.
- Формат рассылки строится на основе шаблона из `Проверка чеков/Анализ рассылок/Рассылки по месяцам - все/`.

---

## Структура проекта (коротко)

```
.
├── platform_gui.py
├── ИИ прогнозирование Чеков/
│   ├── platform_gui.py
│   ├── Прогнозирование на основе МЛ и ВЕСА.py
│   ├── constants.py
│   └── Выгрузки/
├── Обработка чеков/
│   ├── platform_gui.py
│   └── ...
├── Проверка чеков/
│   └── ...
└── cls_2025_12_AZS.xlsx
```

---

## Установка N-BEATS и TTM

Модели N-BEATS и TTM работают через PyTorch. Чтобы они были доступны, установите `torch`:

```bash
pip install torch
```

Если нужна GPU-версия, ставьте PyTorch под свою платформу (CUDA/Metal) по инструкции PyTorch.
Без `torch` прогнозирование будет работать, но эти модели будут недоступны и автоматически пропущены.

Проект полностью выполнен: Манохин Артём (git: @ten101111)